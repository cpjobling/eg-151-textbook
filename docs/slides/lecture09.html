<!DOCTYPE html>
<html lang="en"><head>
<script src="lecture09_files/libs/clipboard/clipboard.min.js"></script>
<script src="lecture09_files/libs/quarto-html/tabby.min.js"></script>
<script src="lecture09_files/libs/quarto-html/popper.min.js"></script>
<script src="lecture09_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="lecture09_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="lecture09_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="lecture09_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="lecture09_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.57">

  <meta name="author" content="Ben Clifford">
  <title>Microcontroller Architecture – Program Operation</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="lecture09_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="lecture09_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #e1e4e8; background-color: #24292e; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #e1e4e8; } /* Normal */
    code span.al { color: #ff5555; font-weight: bold; } /* Alert */
    code span.an { color: #6a737d; } /* Annotation */
    code span.at { color: #f97583; } /* Attribute */
    code span.bn { color: #79b8ff; } /* BaseN */
    code span.bu { color: #f97583; } /* BuiltIn */
    code span.cf { color: #f97583; } /* ControlFlow */
    code span.ch { color: #9ecbff; } /* Char */
    code span.cn { color: #79b8ff; } /* Constant */
    code span.co { color: #6a737d; } /* Comment */
    code span.cv { color: #6a737d; } /* CommentVar */
    code span.do { color: #6a737d; } /* Documentation */
    code span.dt { color: #f97583; } /* DataType */
    code span.dv { color: #79b8ff; } /* DecVal */
    code span.er { color: #ff5555; text-decoration: underline; } /* Error */
    code span.ex { color: #f97583; font-weight: bold; } /* Extension */
    code span.fl { color: #79b8ff; } /* Float */
    code span.fu { color: #b392f0; } /* Function */
    code span.im { color: #9ecbff; } /* Import */
    code span.in { color: #6a737d; } /* Information */
    code span.kw { color: #f97583; } /* Keyword */
    code span.op { color: #e1e4e8; } /* Operator */
    code span.ot { color: #b392f0; } /* Other */
    code span.pp { color: #f97583; } /* Preprocessor */
    code span.re { color: #6a737d; } /* RegionMarker */
    code span.sc { color: #79b8ff; } /* SpecialChar */
    code span.ss { color: #9ecbff; } /* SpecialString */
    code span.st { color: #9ecbff; } /* String */
    code span.va { color: #ffab70; } /* Variable */
    code span.vs { color: #9ecbff; } /* VerbatimString */
    code span.wa { color: #ff5555; } /* Warning */
  </style>
  <link rel="stylesheet" href="lecture09_files/libs/revealjs/dist/theme/quarto.css">
  <link href="lecture09_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="lecture09_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="lecture09_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="lecture09_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="lecture09_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="lecture09_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-dark">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="pictures/image1.png" data-background-opacity="0.9" data-background-size="contain" class="quarto-title-block center">
  <h1 class="title">Microcontroller Architecture – Program Operation</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Ben Clifford 
</div>
        <p class="quarto-title-affiliation">
            Welsh Centre for Printing and Coatings
          </p>
    </div>
</div>

  <p class="date">Tuesday November 19, 2024</p>
</section>
<section class="slide level2">

<aside class="notes">
<p><a href="./slides/lecture09.html">Presentation version</a> of these <a href="#/sec-week08-intro">notes</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="pictures/week08_chapter_heading.png" style="width:100.0%" alt="lecture cover image showing architecture, some gates and an Arduino nano board" class="r-stretch"></section>
<section id="sec-wk8-intro" class="slide level2 unnumbered">
<h2>Introduction</h2>
<div>
<ul>
<li class="fragment">In <a href="./lectures/week02">Introduction to Microcontrollers and Microcontroller Architecture</a>, we discussed some of the core components of a microcontroller’s architecture including the general purpose registers, status register, program counter and stack pointers.</li>
<li class="fragment">Aside from the program counter, these are registers which the programmer can directly access and manipulate.</li>
</ul>
</div>
</section>
<section class="slide level2">

<ul>
<li>In this section, we will look at some of the other components in the microcontroller CPU including the control unit, clock, memory address register, memory data register, instruction register and decoder.</li>
</ul>
<div class="fragment">
<ul>
<li>After introducing these components an example program will be demonstrated that is written in C language, showing the translation to assembly language using the listing file, followed by an explanation of how the program is executed through the fetch-decode-execute cycle.</li>
</ul>
</div>
</section>
<section class="slide level2">

<h3 class="unnumbered" id="contents">Contents</h3>
<div class="columns">
<div class="column" style="width:25%;">
<p><img data-src="pictures/week08_contents_image.png" alt="Decorative image used as a slide background."></p>
</div><div class="column" style="width:75%;">
<ul>
<li><a href="#/sec-wk8-sect1" class="quarto-xref">Section&nbsp;1</a>: <a href="#/sec-wk8-sect1">Architecture recap</a></li>
<li><a href="#/sec-wk8-sect2" class="quarto-xref">Section&nbsp;2</a>: <a href="#/sec-wk8-sect2">Additional components</a></li>
<li><a href="#/sec-wk8-sect3" class="quarto-xref">Section&nbsp;3</a>: <a href="#/sec-wk8-sect3">Fetch-Decode-Execute cycle</a></li>
<li><a href="#/sec-wk8-sect4" class="quarto-xref">Section&nbsp;4</a>: <a href="#/sec-wk8-sect4">An Example Program</a></li>
</ul>
</div></div>
</section>
<section id="sec-wk8-sect1" class="slide level2 center" data-background-image="pictures/week08_wallpaper.png">
<h2>Architecture recap</h2>
</section>
<aside class="notes">
<p><img data-src="pictures/week08_wallpaper.png" alt="mage of a microcontroller used as chapter headings in slide show."></p>
<p><a href="https://wallpaper.dog/microcontroller-wallpapers">wallpaper.dog/microcontroller-wallpapers</a></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<section class="slide level2">

<h3 id="arithmetic-logic-unit-alu">Arithmetic Logic Unit (ALU)</h3>
<aside class="notes">
<p>The Arithmetic Logic Unit (ALU) (<a href="#/fig-wk8-alu" class="quarto-xref">Figure&nbsp;1</a>), is the part of the processor that performs arithmetic and logic operations on data from the storage area.</p>
<p>Memory is used to store data and information but the real goal of the MCU is computation or manipulating data in a structured and purposeful way, like adding two numbers together. These operations are handled by the ALU which is the numerical and logical brain of the MCU. The Atmel ATmega328 has an 8-bit ALU which takes two 8-bit inputs, an opcode describing the operation to perform and outputs an 8-bit result along with a series of 1-bit flags which we can access through the status register.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div id="fig-wk8-alu" class="quarto-float quarto-figure quarto-figure-center" alt="The arithmetic logic unit (ALU).">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-wk8-alu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="pictures/alu.png" style="width:75.0%" alt="The arithmetic logic unit (ALU).">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wk8-alu-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: The arithmetic logic unit (ALU)
</figcaption>
</figure>
</div>
<aside class="notes">
<p>First, data are read from storage into the ALU’s data input ports. Once inside the ALU, they’re modified by means of an arithmetic or logic operation (<code>ADD</code>, <code>SUB</code>, <code>AND</code>, <code>OR</code> …), and then they’re written back to storage via the ALU’s output port.</p>
<p>Depending on the result of the computation, certain flags in the status register will be set or unset.</p>
<p>To illustrate this, here is the reference manual entry for the <strong>add without carry</strong> operator (<code>ADD</code>)</p>
<p><img data-src="pictures/add_op.png" alt="Add without carry operator."></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="the-cpu-core">The CPU Core</h3>
<aside class="notes">
<p>The CPU core of the Atmel ATmega328 microcontroller is illustrated in <a href="#/fig-wk8-cpu_core" class="quarto-xref">Figure&nbsp;2</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div id="fig-wk8-cpu_core" class="quarto-float quarto-figure quarto-figure-center" alt="The CPU core with program counter, status and control register, general registers, and ALU highlighted.">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-wk8-cpu_core-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="pictures/cpu_core.png" alt="The CPU core with program counter, status and control register, general registers, and ALU highlighted.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wk8-cpu_core-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: The CPU core with program counter, status and control register, general registers, and ALU highlighted.
</figcaption>
</figure>
</div>
<aside class="notes">
<p>The CPU core of the Atmel ATmega328 microcontroller with <em>program counter</em>, <em>status and control register</em>, <em>32 general registers</em>, and <em>ALU</em> highlighted.</p>
<p>The highlighted components are:</p>
<p><strong>General Purpose Registers</strong> – 32 8-bit wide registers which are used by the CPU to hold operands and immediate results of arithmetic and logic operations.</p>
<p><strong>Program Counter</strong> – a 14-bit wide register that stores the address of the next instruction or operand to be fetched.</p>
<p><strong>Stack Pointer</strong> – 2 8-bit wide registers that stores the address of the last item in the stack.</p>
<p><strong>Status and Control Register</strong> – an 8-bit wide register that contains information about the state of the&nbsp;processor based on the execution of the last instruction<a href="#/footnotes" class="footnote-ref" id="fnref1" role="doc-noteref" data-footnote-href="#/fn1" onclick=""><sup>1</sup></a>.</p>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>The stack is an area in SRAM where data/information/MCU state can be temporarily pushed on and popped off - the stack pointer holds the memory address of the top of the stack.</p></li>
<li><p>The program counter holds the address of the next address to be executed.</p></li>
<li><p>The general purpose registers are located at the bottom of the data space so can be accessed directly by the ALU. Lower spec microcontrollers/CPUs may only have a single register which is referred to as an accumulator.</p></li>
</ul>
</div>
</div>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<aside></aside></section>
<section id="sec-wk8-sect2" class="slide level2 center" data-background-image="pictures/week08_wallpaper.png">
<h2>Additional components</h2>
</section>
<aside class="notes">
<p><img data-src="pictures/week08_wallpaper.png" alt="Image of a microcontroller used as chapter headings in slide show."></p>
<p><a href="https://wallpaper.dog/microcontroller-wallpapers">wallpaper.dog/microcontroller-wallpapers</a></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<section class="slide level2">

<h3 id="simplified-block-diagram-of-the-microcontroller-core">Simplified block diagram of the microcontroller core</h3>
<aside class="notes">
<p>For this section we will used the simplified block diagram shown in <a href="#/fig-wk8-simplified_bd" class="quarto-xref">Figure&nbsp;3</a> to represent the microcontroller core. This shows the parts that we have already seen as well as the new ones, highlighted, that we will discuss in the following.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="pictures/simple_bd.png" class="r-stretch quarto-figure-center"><p class="caption">
Figure&nbsp;3: Simplified block diagram showing the major components of a microcontroller
</p></section>
<section class="slide level2">

<h3 id="block-1-clock">Block 1: Clock</h3>
<p>The clock generates a signal that oscillates between a high and a low state and acts like a metronome which coordinates/synchronizes the actions of the different microcontroller elements.</p>
<aside class="notes">
<p>The clock signal typically takes the form of a square wave with a 50% duty cycle<a href="#/footnotes" class="footnote-ref" id="fnref2" role="doc-noteref" data-footnote-href="#/fn2" onclick=""><sup>2</sup></a> and a fixed frequency see <a href="#/fig-wk8-clk" class="quarto-xref">Figure&nbsp;4</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="fragment">
<div id="fig-wk8-clk" class="quarto-float quarto-figure quarto-figure-center" alt="A typical clock signal. The frequency is 1/T.">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-wk8-clk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="pictures/clock.png" alt="A typical clock signal. The frequency is 1/T.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wk8-clk-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: A typical clock signal. The frequency is <span class="math inline">\(f=0.5/T_\mathrm{on}\)</span> if <span class="math inline">\(\mu = 0.5\)</span>.
</figcaption>
</figure>
</div>
</div>
<aside class="notes">
<p>In older microcontrollers the clock signal was generated by an external circuit, but modern microcontrollers typically come with an external crystal as well as an internal oscillator.</p>
<p>At every cycle of the clock, a step of the <em>fetch-decode-execute</em> cycle is performed.</p>
<p>The ATmega328 is shipped with an internal RC oscillator with a frequency of 8MHz and the Arduino nano board includes a 16MHz <em>external</em> crystal which is typically set to be the default clock<a href="#/footnotes" class="footnote-ref" id="fnref3" role="doc-noteref" data-footnote-href="#/fn3" onclick=""><sup>3</sup></a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<aside></aside></section>
<section class="slide level2">

<h4 id="internal-clock">Internal Clock</h4>
<aside class="notes">
<p>Internal clocks are made from RC oscillators.</p>
<p>Limited manufacturing abilities mean that there are large differences between individual microcontrollers. These differences are typically <span class="math inline">\(\pm 10\%\)</span>, but clocks can usually be tuned to <span class="math inline">\(\pm 0.5\%\)</span>.</p>
<p><strong>Advantages</strong></p>
<ul>
<li>Cheaper</li>
<li>Leaves pins that are used for the external clock source, e.g.&nbsp;see atmel_clk_pins`, available for other functions such as I/O</li>
<li>Simplifies PCB design and routing for high frequency traces.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="pictures/atmel_clk.png" alt="Pins reserved for an external clock signal on the Atmel ATmega328 microcontroller." class="r-stretch quarto-figure-center"><p class="caption">
Figure&nbsp;5: Pins reserved for an external clock signal on the Atmel ATmega328 microcontroller.
</p></section>
<section class="slide level2">

<h4 id="external-clock">External clock</h4>
<aside class="notes">
<p>Many components inside the microcontroller will use a scaled version of the clock signal (recall the ADC) and so high clock accuracy is not needed. However, for other applications, such as communication based applications like the CAN bus, USB and Ethernet, high frequency and accurate clock signals are required.</p>
<p>For these applications, external ceramic resonators or crystals have a much higher accuracy when it comes to frequency as well as stability.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="pictures/crystal_clk.png" alt="Images of the crystal oscillators used with microcontrollers." class="r-stretch quarto-figure-center"><p class="caption">
Figure&nbsp;6: Examples of the crystal oscillators used with microcontrollers. a) The circuit symbol for a crystal; b) A 16Mhz crystal packaged as a component; c) the external crystal provided with the ATmega328 chip on the Arduino nano board.
</p></section>
<section class="slide level2">

<h4 id="the-atmel-atmega328-clock">The Atmel ATmega328 clock</h4>
<aside class="notes">
<p>A block diagram of the clock circuity is given in <a href="#/fig-wk8-atmel328-clk" class="quarto-xref">Figure&nbsp;7</a>. This is a complex diagram and the details are not too important. What is important is to note is how the clock signal is distributed to all the major subsystems. This is to ensure that all the internal operations that the microcontrollers are carried out in lock-step with the clock signal and in synchronization with each other. The clock sources are shown at the bottom of the diagram and the major blocks which use the clock are at the top. The blocks in the centre of the diagram are concerned with the functions needed to monitor the status of the microcontroller.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="pictures/atmel328_clk.png" alt="Clock distribution of the ATmega328." class="r-stretch quarto-figure-center"><p class="caption">
Figure&nbsp;7: Clock distribution of the ATmega328 (Reproduced from Figure 8.1 of the Atmel ATmega328 data sheet).
</p></section>
<section class="slide level2">

<p>The <strong>CKSEL3..0</strong> are special memory locations in flash memory (“fuses”) that are used to set the clock sources as shown in Table 9.1 of the data sheet reproduced below.</p>

<img data-src="pictures/clksel.png" alt="Reproduction of table 9.1 of the Atmel ATmega328 data sheet." class="r-stretch"></section>
<section class="slide level2">

<h4 id="programmers-registers-for-clock-control">Programmer’s registers for clock control</h4>
<p>There are two registers accessible to the programmer with respect to the clock. These are</p>
<div>
<ul>
<li class="fragment"><strong><code>OSCCAL</code> - Oscillation Calibration Register</strong> used to trim the calibrated internal RC oscillator to remove process variations from the oscillator frequency.y</li>
<li class="fragment"><strong><code>CLKPR</code> – Clock Prescale Register</strong> whose bits define the division factor between the selected clock source and the internal system clock. These bits can be set at run-time to vary the clock frequency to suit the application requirements.</li>
</ul>
</div>
</section>
<section class="slide level2">

<h3 id="block-2-control-unit">Block 2: Control Unit</h3>
<aside class="notes">
<p>The <strong>control unit</strong> coordinates all activities and sends signals through the control bus to all elements of the microcontroller, including the ALU, memory, and input/output, instructing them how to respond to the instructions from the program code it has just read and interpreted from the memory unit.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="fragment">
<p>The control unit is responsible for</p>
</div>
<div>
<ul>
<li class="fragment">Coordinating and controlling activities of the CPU;</li>
<li class="fragment">Managing data flow between other components and the CPU;</li>
<li class="fragment">Acknowledging and accepting the next instruction; and</li>
<li class="fragment">Storing the resulting data back into a memory unit.</li>
</ul>
</div>
</section>
<section class="slide level2">

<h3 id="block-3-memory-address-register-mar">Block 3: Memory Address Register (MAR)</h3>
<p>During operation the address in the program counter is loaded into the <strong>Memory Address Register</strong> and a request is sent onto the address bus to retrieve the data stored at that memory location.</p>
</section>
<section class="slide level2">

<h3 id="block-4-memory-data-register-mdr">Block 4: Memory Data Register (MDR)</h3>
<p>The data at a particular memory location is loaded from the data bus into the <strong>Memory Data Register</strong> before being passed to the <strong>instruction register</strong> or being operated on.</p>
</section>
<section class="slide level2">

<h3 id="block-5-instruction-register-ir">Block 5: Instruction Register (IR)</h3>
<p>After fetching an instruction from program memory, the microcontroller stores it in the <strong>instruction register</strong>.</p>
</section>
<section class="slide level2">

<h3 id="block-6-instruction-decoder-id">Block 6: Instruction Decoder (ID)</h3>
<div>
<ul>
<li class="fragment">The <strong>instruction decoder</strong> decodes the instruction opcode from the <strong>instruction register</strong> and generates appropriate control signals to execute the instruction.</li>
<li class="fragment">It contains a lookup table featuring a mapping of all binary instructions in the microcontroller’s instruction set architecture.</li>
<li class="fragment">Once an instruction arrives at the instruction register it is passed to the decoder. Once decoded the output is passed to the control unit to select the correct hardware for the operation or to get the next word of data from memory.</li>
</ul>
</div>
<aside class="notes">
<p>A summary of some example operations taken from section 5 of the AVR Instruction Set Manual <span class="citation" data-cites="avr_instruction_set">(Atmel 2020)</span> are given in <a href="#/tbl-wk8-table1" class="quarto-xref">Table&nbsp;1</a> in the notes.</p>
<p>The interested reader will find full details at the manual reference quoted in the table.</p>
<div id="tbl-wk8-table1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wk8-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Some examples of instruction decoding
</figcaption>
<div aria-describedby="tbl-wk8-table1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 26%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">16 Bit Opcode</th>
<th style="text-align: left;">Operation</th>
<th style="text-align: left;">Usage</th>
<th style="text-align: left;">Syntax</th>
<th style="text-align: left;">Program Counter (PC)</th>
<th style="text-align: left;">Manual reference</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0001 11rd dddd rrrr</td>
<td style="text-align: left;">Add with carry (<code>ADC</code>)</td>
<td style="text-align: left;">Rd &lt;- Rd + Rr + C<a href="#/footnotes" class="footnote-ref" id="fnref4" role="doc-noteref" data-footnote-href="#/fn4" onclick=""><sup>4</sup></a></td>
<td style="text-align: left;"><code>ADD Rd, Rr</code></td>
<td style="text-align: left;">PC &lt;- PC + 1</td>
<td style="text-align: left;">5.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">0000 11rd dddd rrrr</td>
<td style="text-align: left;">Add without carry (<code>ADD</code>)</td>
<td style="text-align: left;">Rd &lt;- Rd + Rr</td>
<td style="text-align: left;"><code>ADD Rd, Rr</code></td>
<td style="text-align: left;">PC &lt;- PC + 1</td>
<td style="text-align: left;">5.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1001 0110 KKdd KKKK</td>
<td style="text-align: left;">Add Immedidate to Word (<code>ADIW</code>)</td>
<td style="text-align: left;">R[d+1]:Rd &lt;- R[d+1]:Rd + K</td>
<td style="text-align: left;"><code>ADIW Rd+1:Rd,K</code></td>
<td style="text-align: left;">PC &lt;- PC + 1</td>
<td style="text-align: left;">5.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">0010 00rd dddd rrrr</td>
<td style="text-align: left;">Logical AND (<code>AND</code>)</td>
<td style="text-align: left;">Rd &lt;- Rd &amp; Rr</td>
<td style="text-align: left;"><code>AND Rd, Rr</code></td>
<td style="text-align: left;">PC &lt;- PC + 1</td>
<td style="text-align: left;">5.4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0111 KKKK dddd KKKK</td>
<td style="text-align: left;">Logical AND with Immediate (<code>ANDI</code>)</td>
<td style="text-align: left;">Rd &lt;- Rd &amp; K</td>
<td style="text-align: left;"><code>ANDI Rd, K</code></td>
<td style="text-align: left;">PC &lt;- PC + 1</td>
<td style="text-align: left;">5.5</td>
</tr>
<tr class="even">
<td style="text-align: left;">1001 010d dddd 0101</td>
<td style="text-align: left;">Arithmetic Shift Right (<code>ASR</code>)</td>
<td style="text-align: left;"><img data-src="pictures/asr.png"></td>
<td style="text-align: left;"><code>ASR Rd</code></td>
<td style="text-align: left;">PC &lt;- PC + 1</td>
<td style="text-align: left;">5.6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1001 0100 1sss 1000</td>
<td style="text-align: left;">Bit Clear in SREG (<code>BCLR</code>)</td>
<td style="text-align: left;">SREG(s) &lt;- 0</td>
<td style="text-align: left;"><code>BCLR s</code></td>
<td style="text-align: left;">PC &lt;- PC + 1</td>
<td style="text-align: left;">5.7</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<aside></aside></section>
<section class="slide level2">

<h3 id="busses">Busses</h3>
<aside class="notes">
<p>Inside the microcontroller, components communicate with each other using sets of parallel connectors known as buses. The processor is connected to the main memory by three separate buses as illustrated in <a href="#/fig-wk8-busses" class="quarto-xref">Figure&nbsp;8</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>

<img data-src="pictures/mc_busses.png" alt="The three busses in the ATmega328 microntroller." class="r-stretch quarto-figure-center"><p class="caption">
Figure&nbsp;8: The three busses in the ATmega328 microntroller.
</p><aside class="notes">
<p>The three buses are:</p>
<ul>
<li><strong>Address bus</strong>: a unidirectional bus from the processor to the memory or an I/O controller that carries the location of the data to be read from or written to.</li>
<li><strong>Data bus</strong>: a bi-directional pathway that carries data or instructions between processor components. The width of data bus is key in determining the overall computer performance. The AVR CPU data bus is 8-bits wide but the word size is 16-bits meaning the data bus has to use two cloxk cycles to fetch each byte of a word from the main memory.</li>
<li><strong>Control bus</strong>: is a bi-directional pathway that carries command, timing and specific status information among components. Examples of control information include:
<ul>
<li>Read/write from/to memory</li>
<li>Read/write from/to I/O port</li>
<li>Request access to the data bus</li>
<li>Grant access to the data bus</li>
<li>Sync clock</li>
<li>Reset</li>
</ul></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="sec-wk8-sect3" class="slide level2 center" data-background-image="pictures/week08_wallpaper.png">
<h2>Fetch-Decode-Execute cycle</h2>
</section>
<aside class="notes">
<p><img data-src="pictures/week08_wallpaper.png" alt="Image of a microcontroller used as chapter headings in slide show."></p>
<p><a href="https://wallpaper.dog/microcontroller-wallpapers">wallpaper.dog/microcontroller-wallpapers</a></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<section class="slide level2">

<h3 id="sec-wk8-add-code">Recap: Program Instructions</h3>
<aside class="notes">
<p>The microcontroller program consists of a sequence of instructions, each consisting of an opcode (<code>LDI</code>, <code>ADD</code>, <code>OUT</code>, etc…) defining the operation to be carried out and an operand containing the data or location of the data which the instruction is to operate on.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div class="fragment">
<p><strong>High level language</strong></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource c number-lines code-with-copy"><code class="sourceCode c"><span id="cb1-1"><a href=""></a>myVariable <span class="op">=</span> <span class="dv">121</span> <span class="op">+</span> <span class="dv">103</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p><img data-src="pictures/arrow.png" data-fig-qlt="Arrow pointing downwards"></p>
<p><strong>Low Level Language</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource asm number-lines code-with-copy"><code class="sourceCode fasm"><span id="cb2-1"><a href=""></a>LDI r16<span class="op">,</span> <span class="bn">0b</span><span class="er">01111001</span></span>
<span id="cb2-2"><a href=""></a>LDI r17<span class="op">,</span> <span class="bn">0b</span><span class="er">01100111</span></span>
<span id="cb2-3"><a href=""></a><span class="bu">ADD</span> r16<span class="op">,</span> r17</span>
<span id="cb2-4"><a href=""></a>STS <span class="bn">0xFF00</span><span class="op">,</span> r16</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p><img data-src="pictures/arrow.png" data-fig-qlt="Arrow pointing downwards"></p>
<p><strong>Machine Code</strong></p>
<pre><code>1110011100001001
1110011000010111
0000111100000001
1001001100000000
1111111100000000</code></pre>
</div>
</section>
<section class="slide level2">

<h3 id="fetch-decode-execute-cycle">Fetch-Decode-Execute Cycle</h3>
<p>Each instruction is carried out by a sequence of operations, known as the <strong>fetch-decode-execute cycle</strong> illustrated as a flow chart in <a href="#/fig-wk8-fetch-decode-execute-cycle" class="quarto-xref">Figure&nbsp;9</a>.</p>
</section>
<section class="slide level2">

<h4 id="flowchart-of-fetch-decode-execute-cycle">Flowchart of fetch-decode-execute cycle</h4>

<img data-src="pictures/fetch_decode_execute_cycle.png" style="width:50.0%" alt="A flow chart illustrating the fetch-decode-execute cycle." class="r-stretch quarto-figure-center"><p class="caption">
Figure&nbsp;9: A flow chart illustrating the fetch-decode-execute cycle
</p><aside class="notes">
<p>The fetch-decode-execute cycle follows the following steps</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h4 id="fetch">Fetch</h4>
<div>
<ul>
<li class="fragment"><strong>Fetch</strong> the operator code from memory via the data bus and store it in the instruction register.</li>
</ul>
<aside class="notes">
<p>This occurs by placing an address on the address bus and then reading the instruction at this address from the data bus.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<ul>
<li class="fragment">The address of the instruction to be fetched is stored in the program counter which is then loaded into the <strong>Memory Address Register</strong> and a request is sent onto the address bus.</li>
<li class="fragment">The program counter is then incremented to point to the next sequential memory address.</li>
<li class="fragment">The contents of the memory location are then transferred through the data bus to the <strong>Memory Data Register</strong> and then into the <strong>instruction register</strong> before passing to the decoder.</li>
</ul>
</div>
</section>
<section class="slide level2">

<h4 id="decode">Decode</h4>
<ul>
<li><strong>Decode</strong> the operator code within the instruction decoder and determine the nature of the operation specified (load immediately, load a byte from memory, load a word from memory). Fetch further data using the address and data busses as necessary based on the instruction decoded.</li>
</ul>
</section>
<section class="slide level2">

<h4 id="execute">Execute</h4>
<ul>
<li>*<strong>Execute</strong> the instruction on the necessary operands.</li>
</ul>
</section>
<section class="slide level2">

<h4 id="continue">Continue</h4>
<ul>
<li>The fetch-decode-execute is now complete and starts again for the next code memory location indicated by the program counter.</li>
</ul>
</section>
<section class="slide level2">

<h3 id="fetch-decode-execute-cycle-algorithm">Fetch-Decode-Execute cycle algorithm</h3>
<p>The process is illustrated as an algorithm below</p>
<div class="fragment">
<p>Step 1:</p>
<pre><code>MAR &lt;- (PC)</code></pre>
<aside class="notes">
<p>The address in the program counter (PC) is transferred to the memory address register (MAR).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<div class="fragment">
<p>Step 2:</p>
<pre><code>(PC) &lt;- (PC) + 1</code></pre>
<aside class="notes">
<p>The program counter is incremented to point to the next instruction.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<div class="fragment">
<p>Step 3:</p>
<pre><code>MDR &lt;- (MAR)</code></pre>
<aside class="notes">
<p>The contents of the location specified by the memory address register (MAR) are transferred to the memory data register (MDR).</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
<div class="fragment">
<p>Step 4:</p>
<pre><code>IR &lt;- (MDR)</code></pre>
<aside class="notes">
<p>The contents of the memory data register (MDR) are loaded to the instruction register (IR) and then decoded.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</div>
</section>
<section class="slide level2">

</section>
<section id="sec-wk8-sect4" class="slide level2 center" data-background-image="pictures/week08_wallpaper.png">
<h2>An Example Program</h2>
</section>
<aside class="notes">
<p><a href="pictures/week08_wallpaper.png" data-fig-alt="Image of a microcontroller used as chapter headings in slide show."></a></p>
<p><a href="https://wallpaper.dog/microcontroller-wallpapers">wallpaper.dog/microcontroller-wallpapers</a></p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<section class="slide level2">

<h3 id="recall-the-digital-io-program">Recall the digital I/O program…</h3>
<div id="lst-wk8-add-code" class="c listing quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-lst">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-wk8-add-code-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;1: Digital I/O program in C
</figcaption>
<div aria-describedby="lst-wk8-add-code-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode" id="lst-wk8-add-code"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="lst-wk8-add-code-1"><a href="#lst-wk8-add-code-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="lst-wk8-add-code-2"><a href="#lst-wk8-add-code-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-wk8-add-code-3"><a href="#lst-wk8-add-code-3" aria-hidden="true" tabindex="-1"></a><span class="co">//I/O and ADC Register definitions taken from datasheet</span></span>
<span id="lst-wk8-add-code-4"><a href="#lst-wk8-add-code-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PORTD </span><span class="op">(*(</span><span class="dt">volatile</span><span class="pp"> </span><span class="dt">uint8_t</span><span class="pp"> </span><span class="op">*)(</span><span class="bn">0x2B</span><span class="op">))</span></span>
<span id="lst-wk8-add-code-5"><a href="#lst-wk8-add-code-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DDRD </span><span class="op">(*(</span><span class="dt">volatile</span><span class="pp"> </span><span class="dt">uint8_t</span><span class="pp"> </span><span class="op">*)(</span><span class="bn">0x2A</span><span class="op">))</span></span>
<span id="lst-wk8-add-code-6"><a href="#lst-wk8-add-code-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PIND </span><span class="op">(*(</span><span class="dt">volatile</span><span class="pp"> </span><span class="dt">uint8_t</span><span class="pp"> </span><span class="op">*)(</span><span class="bn">0x29</span><span class="op">))</span></span>
<span id="lst-wk8-add-code-7"><a href="#lst-wk8-add-code-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-wk8-add-code-8"><a href="#lst-wk8-add-code-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PORTB </span><span class="op">(*(</span><span class="dt">volatile</span><span class="pp"> </span><span class="dt">uint8_t</span><span class="pp"> </span><span class="op">*)(</span><span class="bn">0x25</span><span class="op">))</span></span>
<span id="lst-wk8-add-code-9"><a href="#lst-wk8-add-code-9" aria-hidden="true" tabindex="-1"></a><span class="pp">#define DDRB </span><span class="op">(*(</span><span class="dt">volatile</span><span class="pp"> </span><span class="dt">uint8_t</span><span class="pp"> </span><span class="op">*)(</span><span class="bn">0x24</span><span class="op">))</span></span>
<span id="lst-wk8-add-code-10"><a href="#lst-wk8-add-code-10" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PINB </span><span class="op">(*(</span><span class="dt">volatile</span><span class="pp"> </span><span class="dt">uint8_t</span><span class="pp"> </span><span class="op">*)(</span><span class="bn">0x23</span><span class="op">))</span></span>
<span id="lst-wk8-add-code-11"><a href="#lst-wk8-add-code-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-wk8-add-code-12"><a href="#lst-wk8-add-code-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="lst-wk8-add-code-13"><a href="#lst-wk8-add-code-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="lst-wk8-add-code-14"><a href="#lst-wk8-add-code-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">//Set Data Direction Registers</span></span>
<span id="lst-wk8-add-code-15"><a href="#lst-wk8-add-code-15" aria-hidden="true" tabindex="-1"></a>    DDRD <span class="op">=</span> DDRD <span class="op">&amp;</span> <span class="bn">0b11110011</span><span class="op">;</span> <span class="co">//setup bits 2 and 3 of port D as inputs</span></span>
<span id="lst-wk8-add-code-16"><a href="#lst-wk8-add-code-16" aria-hidden="true" tabindex="-1"></a>    DDRB <span class="op">=</span> DDRB <span class="op">|</span> <span class="bn">0b00000011</span><span class="op">;</span> <span class="co">//setup bits 0 and 1 of port B as outputs</span></span>
<span id="lst-wk8-add-code-17"><a href="#lst-wk8-add-code-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="lst-wk8-add-code-18"><a href="#lst-wk8-add-code-18" aria-hidden="true" tabindex="-1"></a>    PORTB <span class="op">=</span> PORTB <span class="op">&amp;</span> <span class="bn">0b11111100</span><span class="op">;</span> <span class="co">//both pins B0 (D8) and B1 (D9) start low</span></span>
<span id="lst-wk8-add-code-19"><a href="#lst-wk8-add-code-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-wk8-add-code-20"><a href="#lst-wk8-add-code-20" aria-hidden="true" tabindex="-1"></a>    PORTD <span class="op">=</span> PORTD <span class="op">|</span> <span class="bn">0b00001100</span><span class="op">;</span> <span class="co">// Enable the pull up resistor for bits 2 and 3 of port D</span></span>
<span id="lst-wk8-add-code-21"><a href="#lst-wk8-add-code-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-wk8-add-code-22"><a href="#lst-wk8-add-code-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(;;)</span></span>
<span id="lst-wk8-add-code-23"><a href="#lst-wk8-add-code-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="lst-wk8-add-code-24"><a href="#lst-wk8-add-code-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span><span class="op">((</span>PIND <span class="op">&amp;</span> <span class="bn">0b00000100</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="lst-wk8-add-code-25"><a href="#lst-wk8-add-code-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="lst-wk8-add-code-26"><a href="#lst-wk8-add-code-26" aria-hidden="true" tabindex="-1"></a>            PORTB <span class="op">=</span> PORTB <span class="op">|</span> <span class="bn">0b00000001</span><span class="op">;</span> <span class="co">//sets port B, bit 0 to logic 1/high, switches the LED connected to D8 on</span></span>
<span id="lst-wk8-add-code-27"><a href="#lst-wk8-add-code-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-wk8-add-code-28"><a href="#lst-wk8-add-code-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span> <span class="cf">if</span> <span class="op">((</span>PIND <span class="op">&amp;</span> <span class="bn">0b00001000</span><span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="lst-wk8-add-code-29"><a href="#lst-wk8-add-code-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="lst-wk8-add-code-30"><a href="#lst-wk8-add-code-30" aria-hidden="true" tabindex="-1"></a>            PORTB <span class="op">=</span> PORTB <span class="op">|</span> <span class="bn">0b00000010</span><span class="op">;</span> <span class="co">//sets port B, bit 1 to logic 1/high, switches the LED connected to D9 on</span></span>
<span id="lst-wk8-add-code-31"><a href="#lst-wk8-add-code-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-wk8-add-code-32"><a href="#lst-wk8-add-code-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span></span>
<span id="lst-wk8-add-code-33"><a href="#lst-wk8-add-code-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="lst-wk8-add-code-34"><a href="#lst-wk8-add-code-34" aria-hidden="true" tabindex="-1"></a>            PORTB <span class="op">=</span> PORTB <span class="op">&amp;</span> <span class="bn">0b11111100</span><span class="op">;</span> <span class="co">//sets bits 0-5 of port B to logic 0/low, switches off both the LED's</span></span>
<span id="lst-wk8-add-code-35"><a href="#lst-wk8-add-code-35" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="lst-wk8-add-code-36"><a href="#lst-wk8-add-code-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="lst-wk8-add-code-37"><a href="#lst-wk8-add-code-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="lst-wk8-add-code-38"><a href="#lst-wk8-add-code-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</figure>
</div>
<p>Code: <a href="https://gist.github.com/cpjobling/07585093f8eafe69a4eeff1186110883">main.c</a></p>
</section>
<section class="slide level2">

<h3 id="listing-file">Listing File</h3>
<aside class="notes">
<p>This is the listing file (refer to <a href="#/lst-wk8-assembly" class="quarto-xref">Listing&nbsp;2</a>) generated by the assembler which shows each line of C code and what it has been translated to in assembly language along with the memory address the instruction will be stored at<a href="#/footnotes" class="footnote-ref" id="fnref5" role="doc-noteref" data-footnote-href="#/fn5" onclick=""><sup>5</sup></a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div id="lst-wk8-assembly" class="listing quarto-float quarto-figure quarto-figure-left">
<figure class="quarto-float quarto-float-lst">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-lst" id="lst-wk8-assembly-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Listing&nbsp;2: Listing file for example program
</figcaption>
<div aria-describedby="lst-wk8-assembly-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="lst-wk8-assembly"><code>00000080 &lt;main&gt;:
#define PINB (*(volatile uint8_t *)(0x23))

int main(void)
{
    //Set Data Direction Registers
    DDRD = DDRD &amp; 0b11110011; //setup bits 2 and 3 of port D as inputs
  80:   8a b1           in  r24, 0x0a   ; 10
  82:   83 7f           andi    r24, 0xF3   ; 243
  84:   8a b9           out 0x0a, r24   ; 10
    DDRB = DDRB | 0b00000011; //setup bits 0 and 1 of port B as outputs
  86:   84 b1           in  r24, 0x04   ; 4
  88:   83 60           ori r24, 0x03   ; 3
  8a:   84 b9           out 0x04, r24   ; 4

    PORTB = PORTB &amp; 0b11111100; //both pins B0 (D8) and B1 (D9) start low
  8c:   85 b1           in  r24, 0x05   ; 5
  8e:   8c 7f           andi    r24, 0xFC   ; 252
  90:   85 b9           out 0x05, r24   ; 5
    
    PORTD = PORTD | 0b00001100; // Enable the pull up resistor for bits 2 and 3 of port D
  92:   8b b1           in  r24, 0x0b   ; 11
  94:   8c 60           ori r24, 0x0C   ; 12
  96:   8b b9           out 0x0b, r24   ; 11
    
    for(;;)
    {
        if((PIND &amp; 0b00000100) == 0)
  98:   4a 99           sbic    0x09, 2 ; 9
  9a:   02 c0           rjmp    .+4         ; 0xa0 &lt;main+0x20&gt;
        {
            PORTB = PORTB | 0b00000001; //sets port B, bit 0 to logic 1/high, switches the LED connected to D8 on
  9c:   28 9a           sbi 0x05, 0 ; 5
  9e:   fc cf           rjmp    .-8         ; 0x98 &lt;main+0x18&gt;
        }
        else if ((PIND &amp; 0b00001000) == 0)
  a0:   4b 99           sbic    0x09, 3 ; 9
  a2:   02 c0           rjmp    .+4         ; 0xa8 &lt;main+0x28&gt;
        {
            PORTB = PORTB | 0b00000010; //sets port B, bit 1 to logic 1/high, switches the LED connected to D9 on
  a4:   29 9a           sbi 0x05, 1 ; 5
  a6:   f8 cf           rjmp    .-16        ; 0x98 &lt;main+0x18&gt;
        }
        else
        {
            PORTB = PORTB &amp; 0b11111100; //sets bits 0-5 of port B to logic 0/low, switches off both the LED's
  a8:   85 b1           in  r24, 0x05   ; 5
  aa:   8c 7f           andi    r24, 0xFC   ; 252
  ac:   85 b9           out 0x05, r24   ; 5
  ae:   f4 cf           rjmp    .-24        ; 0x98 &lt;main+0x18&gt;

000000b0 &lt;_exit&gt;:
  b0:   f8 94           cli

000000b2 &lt;__stop_program&gt;:
  b2:   ff cf           rjmp    .-2         ; 0xb2 &lt;__stop_program&gt;</code></pre>
</div>
</figure>
</div>
<aside></aside></section>
<section class="slide level2 scrollable">

<h3 id="fetch-1">Fetch</h3>

<img data-src="pictures/fetch_example.png" alt="The fetch operation as a video." class="r-stretch"><aside class="notes">
<p><strong>Fetch operation described</strong></p>
<ol type="1">
<li>The PC is set to $0040.</li>
<li>The contents of the PC is copied to the MAR and transferred via the address bus to the memory controller.</li>
<li>The value of PC is incremented.</li>
<li>The contents of the memory location specified by the MAR are transferred via the data bus to the MDR</li>
<li>The contents of the MDR are placed into the IR.</li>
</ol>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="decode-1">Decode</h3>
<p><img data-src="pictures/decode_example.png" alt="The decode operation as a video."></p>
<aside class="notes">
<p><strong>Decode operation described</strong></p>
<p>The program instruction at line 40 is b1 8a = 1011 0001 1000 1010.</p>
<p>The most significant 5 bits 10110 correspond to the <code>IN</code> opcode <span class="citation" data-cites="avr_instruction_set">(Atmel 2020, sec. 5.61)</span>.</p>
<p><img data-src="pictures/in_opcode.png" alt="Documentation for the IN opcode."></p>
<p>From the documentation the remaining bits are distributed as per the table below:</p>
<table class="caption-top">
<thead>
<tr class="header">
<th>opcode</th>
<th>AA</th>
<th>ddddd</th>
<th>AAAA</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>10110</td>
<td>00</td>
<td>11000</td>
<td>1010</td>
</tr>
</tbody>
</table>
<p>So</p>
<p>AAAAAA = 00 1010 (0x0A) and ddddd = 11000 (24).</p>
<p>Disassembling the instruction gives:</p>
<pre><code>in r24, 0x0a</code></pre>
<p>which in words is <em>read I/O register 0x0A into register 24</em>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2 scrollable">

<h3 id="execute-1">Execute</h3>

<img data-src="pictures/execute_example.png" alt="The execute operation as a video." class="r-stretch"><aside class="notes">
<p><strong>Execute operation described</strong></p>
<ol type="1">
<li>MAR set to I/O register $000A (DDRD) and transferred via the address bus to the memory controller.</li>
<li>The contents of the memory location specified by the MAR are transferred via the data bus to the MDR.</li>
<li>The contents of the MDR are copied to R24</li>
</ol>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section class="slide level2">

<h3 id="assembly-to-machine-code">Assembly to Machine Code</h3>
<aside class="notes">
<p>The assembly/machine code instructions equivalent to the program given in <a href="#/lst-wk8-add-code" class="quarto-xref">Listing&nbsp;1</a> above is tabulated in <a href="#/tbl-wk8-table2" class="quarto-xref">Table&nbsp;2</a>. Refer also to <a href="./lectures/week07/index.html#wk7-assembler">Introduction to Assembly Language</a>.</p>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
<div id="tbl-wk8-table2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wk8-table2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Assembly to machine code
</figcaption>
<div aria-describedby="tbl-wk8-table2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top">
<colgroup>
<col style="width: 27%">
<col style="width: 35%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Assembler</th>
<th style="text-align: left;">Machine Code</th>
<th style="text-align: left;">Documentation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>ldi r16, 0b01111001</code></td>
<td style="text-align: left;">1110 0110 0001 0111</td>
<td style="text-align: left;"><img data-src="pictures/ldi_opcode.png"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>ldi r17, 0b01100111</code></td>
<td style="text-align: left;">1110 0110 0001 0111</td>
<td style="text-align: left;">See cell above</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>add r16, r17</code></td>
<td style="text-align: left;">0000 1111 0000 0001</td>
<td style="text-align: left;"><img data-src="pictures/add_opcode.png"></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>sts 0xFF00, r16</code></td>
<td style="text-align: left;">1001 0011 0000 0000 1111 1111 0000 0000</td>
<td style="text-align: left;"><img data-src="pictures/sts_opcode.png"></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="summary" class="slide level2 unnumbered">
<h2>Summary</h2>
<p>In this section we have:</p>
<div>
<ul>
<li class="fragment">Recapped the core components of the AVR CPU including the ALU, general purpose registers, program counter, stack pointer and status register as well as their function in the microcontroller.</li>
<li class="fragment">Looked at the function of some of the other components within the CPU including the clock, memory address register, memory data register, instruction register and decoder.</li>
<li class="fragment">Looked at an example of what happens during program execution through the fetch-decode-execute cycle.</li>
</ul>
</div>
</section>
<section class="slide level2">

<h3 class="unnumbered" id="on-canvas">On Canvas</h3>
<p>This week on the canvas course pages, you will find a <a href="https://canvas.swansea.ac.uk/courses/44971/assignments/52902">short quiz</a> to test your knowledge on these topics.</p>
</section>
<section class="slide level2">

<h3 class="unnumbered" id="next-time">Next time</h3>
<ul>
<li><a href="./lectures/week09">Addressing Modes</a></li>
</ul>
<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document smaller scrollable" role="doc-endnotes"><h2>Footnotes</h2>

<ol>
<li id="fn1"><p>The status and control register also contains bits that can change the operation of the microcontroller. For example the <em>global interrupt enable</em> bit is set if interrupts have been enabled. Interrupts will be discussed in EG-252 next year.</p></li>
<li id="fn2"><p>The duty cycle is <span class="math inline">\(\mu=T_\mathrm{on}/\left(T_\mathrm{on}+T_\mathrm{off}\right)\)</span> and <span class="math inline">\(\mu = 0.5\)</span> (50%) if <span class="math inline">\(T_\mathrm{on}=T_\mathrm{off}\)</span>. That is for half of a cycle (i.e.&nbsp;for <span class="math inline">\(T_\mathrm{on}\)</span>s) it is in a high state and for the other half of the cycle (for <span class="math inline">\(T_\mathrm{off}\)</span>s) it is in a low state.</p></li>
<li id="fn3"><p>If the frequency is <span class="math inline">\(x\)</span>MHz, then the microcontroller can execute <span class="math inline">\(x\)</span> million instructions a second and each instruction takes 1/x microseconds to execute. Therefore, for the ATmega328 with internal clock the execution speed is 0.125<span class="math inline">\(\mu\)</span>s per instruction. For the ATmega328 on the Arduino nano it is half this.</p></li>
<li id="fn4"><p>The carry flag C comes from the status register.</p></li>
<li id="fn5"><p>This file is not completely accurate as the assembler used has assumed the memory space is 8-bits wide where as it is actually 16-bits wide. This means each memory address shown should be divided by 2.</p></li>
</ol>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="lecture09_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="lecture09_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="lecture09_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="lecture09_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
          let selectedAnnoteEl;
          const selectorForAnnotation = ( cell, annotation) => {
            let cellAttr = 'data-code-cell="' + cell + '"';
            let lineAttr = 'data-code-annotation="' +  annotation + '"';
            const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
            return selector;
          }
          const selectCodeLines = (annoteEl) => {
            const doc = window.document;
            const targetCell = annoteEl.getAttribute("data-target-cell");
            const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
            const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            const lines = annoteSpan.getAttribute("data-code-lines").split(",");
            const lineIds = lines.map((line) => {
              return targetCell + "-" + line;
            })
            let top = null;
            let height = null;
            let parent = null;
            if (lineIds.length > 0) {
                //compute the position of the single el (top and bottom and make a div)
                const el = window.document.getElementById(lineIds[0]);
                top = el.offsetTop;
                height = el.offsetHeight;
                parent = el.parentElement.parentElement;
              if (lineIds.length > 1) {
                const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
                const bottom = lastEl.offsetTop + lastEl.offsetHeight;
                height = bottom - top;
              }
              if (top !== null && height !== null && parent !== null) {
                // cook up a div (if necessary) and position it 
                let div = window.document.getElementById("code-annotation-line-highlight");
                if (div === null) {
                  div = window.document.createElement("div");
                  div.setAttribute("id", "code-annotation-line-highlight");
                  div.style.position = 'absolute';
                  parent.appendChild(div);
                }
                div.style.top = top - 2 + "px";
                div.style.height = height + 4 + "px";
                div.style.left = 0;
                let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
                if (gutterDiv === null) {
                  gutterDiv = window.document.createElement("div");
                  gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                  gutterDiv.style.position = 'absolute';
                  const codeCell = window.document.getElementById(targetCell);
                  const gutter = codeCell.querySelector('.code-annotation-gutter');
                  gutter.appendChild(gutterDiv);
                }
                gutterDiv.style.top = top - 2 + "px";
                gutterDiv.style.height = height + 4 + "px";
              }
              selectedAnnoteEl = annoteEl;
            }
          };
          const unselectCodeLines = () => {
            const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
            elementsIds.forEach((elId) => {
              const div = window.document.getElementById(elId);
              if (div) {
                div.remove();
              }
            });
            selectedAnnoteEl = undefined;
          };
            // Handle positioning of the toggle
        window.addEventListener(
          "resize",
          throttle(() => {
            elRect = undefined;
            if (selectedAnnoteEl) {
              selectCodeLines(selectedAnnoteEl);
            }
          }, 10)
        );
        function throttle(fn, ms) {
        let throttle = false;
        let timer;
          return (...args) => {
            if(!throttle) { // first call gets through
                fn.apply(this, args);
                throttle = true;
            } else { // all the others get throttled
                if(timer) clearTimeout(timer); // cancel #2
                timer = setTimeout(() => {
                  fn.apply(this, args);
                  timer = throttle = false;
                }, ms);
            }
          };
        }
          const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
          for (let i=0; i<annoteTargets.length; i++) {
            const annoteTarget = annoteTargets[i];
            const targetCell = annoteTarget.getAttribute("data-target-cell");
            const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
            const contentFn = () => {
              const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
              if (content) {
                const tipContent = content.cloneNode(true);
                tipContent.classList.add("code-annotation-tip-content");
                return tipContent.outerHTML;
              }
            }
            const config = {
              allowHTML: true,
              content: contentFn,
              onShow: (instance) => {
                selectCodeLines(instance.reference);
                instance.reference.classList.add('code-annotation-active');
                window.tippy.hideAll();
              },
              onHide: (instance) => {
                unselectCodeLines();
                instance.reference.classList.remove('code-annotation-active');
              },
              maxWidth: 300,
              delay: [50, 0],
              duration: [200, 0],
              offset: [5, 10],
              arrow: true,
              appendTo: function(el) {
                return el.parentElement.parentElement.parentElement;
              },
              interactive: true,
              interactiveBorder: 10,
              theme: 'light-border',
              placement: 'right',
              popperOptions: {
                modifiers: [
                {
                  name: 'flip',
                  options: {
                    flipVariations: false, // true by default
                    allowedAutoPlacements: ['right'],
                    fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                  },
                },
                {
                  name: 'preventOverflow',
                  options: {
                    mainAxis: false,
                    altAxis: false
                  }
                }
                ]        
              }      
            };
            window.tippy(annoteTarget, config); 
          }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>